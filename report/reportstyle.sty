% reportstyle.sty - 自定义报告样式包
% 版本: 1.1
% 作者: [您的姓名]
% 日期: \today
% 说明: 支持中文的报告样式包，需要使用 XeLaTeX 编译

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{reportstyle}[2025/09/20 v1.1 Custom Report Style Package with CJK Support]

% 必要的包
\RequirePackage[utf8]{inputenc}
\RequirePackage[T1]{fontenc}

% 中文支持
\RequirePackage{xeCJK}
\RequirePackage{fontspec}

% 设置中文字体 (优先使用 Noto 字体系列)
\IfFontExistsTF{Noto Serif CJK SC}{
    \setCJKmainfont{Noto Serif CJK SC}
    \setCJKsansfont{Noto Sans CJK SC}
    \setCJKmonofont{Noto Sans Mono CJK SC}
}{
    % 备选字体方案
    \IfFontExistsTF{FandolSong}{
        \setCJKmainfont{FandolSong}
        \setCJKsansfont{FandolHei}
        \setCJKmonofont{FandolFang}
    }{
        % 最后备选：使用 SimSun
        \setCJKmainfont{SimSun}
        \setCJKsansfont{SimHei}
        \setCJKmonofont{SimSun}
    }
}

% 西文字体设置 (使用 Noto 字体系列保持一致性)
\IfFontExistsTF{Noto Sans}{
    \setmainfont{Noto Serif}
    \setsansfont{Noto Sans}
    \setmonofont{Noto Sans Mono}
}{
    % 备选西文字体
    \setmainfont{DejaVu Serif}
    \setsansfont{DejaVu Sans}
    \setmonofont{DejaVu Sans Mono}
}

% 数学和符号包
\RequirePackage{amsmath,amsfonts,amssymb}

% 图形和表格包
\RequirePackage{graphicx}
\RequirePackage{booktabs}
\RequirePackage{array}
\RequirePackage{longtable}
\RequirePackage{float}

% 页面布局和样式包
\RequirePackage{fancyhdr}
\RequirePackage{geometry}
\RequirePackage{xcolor}
\RequirePackage{caption}

% 超链接支持 (必须在最后加载)
\RequirePackage{hyperref}

% 超链接配置
\hypersetup{
    colorlinks=true,           % 使用彩色链接而不是边框
    linkcolor=linkcolor,    % 内部链接颜色（目录、引用等）
    urlcolor=blue,            % URL链接颜色
    citecolor=citecolor, % 引用链接颜色
    filecolor=magenta,        % 文件链接颜色
    bookmarksnumbered=true,   % 书签中显示章节编号
    bookmarksopen=true,       % 打开时展开书签
}

% 在文档开始时设置PDF元数据的命令
\AtBeginDocument{
    \hypersetup{
        pdftitle={\@title},    % 使用文档的标题
        pdfauthor={\@author}, % 使用文档的作者
        pdfsubject={Report},      % PDF主题
        pdfkeywords={LaTeX, Report, Template} % PDF关键词
    }
}

% 页面几何设置
\geometry{
    left=2.5cm,
    right=2.5cm,
    top=3cm,
    bottom=3cm,
    headheight=14pt
}

% 页眉页脚样式设置
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0.4pt}  % 页眉细线
\renewcommand{\footrulewidth}{0.4pt}  % 页脚细线

% 定义页眉页脚设置命令
\newcommand{\setreportheader}[2]{%
    \lhead{#1}%
    \rhead{#2}%
    \cfoot{\thepage\ / \pageref*{LastPage}}%  % 显示当前页/总页数（无链接）
}

% 添加最后一页标签的包
\RequirePackage{lastpage}

% 默认页眉设置
\setreportheader{Report}{{\today}}

% 表格和图片标题设置
\captionsetup{
    font=small,
    labelfont=bf,
    format=plain,
    justification=justified,
    singlelinecheck=false
}

% 自定义颜色定义
\definecolor{primarycolor}{RGB}{0,128,128}   % 青绿色
\definecolor{secondarycolor}{RGB}{70,130,180} % 钢蓝色
\definecolor{accentcolor}{RGB}{255,165,0}    % 橙色
\definecolor{linkcolor}{RGB}{0,128,255}    % 天蓝色
\definecolor{citecolor}{RGB}{128,128,128} % 灰色
% 自定义节标题样式
\RequirePackage{titlesec}
\titleformat{\section}
{\normalfont\Large\bfseries\color{primarycolor}}
{\thesection}{1em}{}

\titleformat{\subsection}
{\normalfont\large\bfseries\color{secondarycolor}}
{\thesubsection}{1em}{}

\titleformat{\subsubsection}
{\normalfont\normalsize\bfseries\color{accentcolor}}
{\thesubsubsection}{1em}{}

% 自定义环境
% 信息框环境
\RequirePackage{mdframed}
\newmdenv[
    backgroundcolor=blue!10,
    linecolor=blue,
    linewidth=2pt,
    leftmargin=10pt,
    rightmargin=10pt,
    innertopmargin=10pt,
    innerbottommargin=10pt
]{infobox}

% 警告框环境
\newmdenv[
    backgroundcolor=orange!10,
    linecolor=orange,
    linewidth=2pt,
    leftmargin=10pt,
    rightmargin=10pt,
    innertopmargin=10pt,
    innerbottommargin=10pt
]{warningbox}

% 成功框环境
\newmdenv[
    backgroundcolor=green!10,
    linecolor=green!70!black,
    linewidth=2pt,
    leftmargin=10pt,
    rightmargin=10pt,
    innertopmargin=10pt,
    innerbottommargin=10pt
]{successbox}

% 带颜色参数的note环境
\RequirePackage{xparse}
\NewDocumentEnvironment{note}{O{primarycolor}}{%
    \begin{mdframed}[
            backgroundcolor=gray!5,
            linecolor=#1,
            linewidth=3pt,
            leftline=true,
            rightline=false,
            topline=false,
            bottomline=false,
            leftmargin=20pt,
            rightmargin=10pt,
            innertopmargin=10pt,
            innerbottommargin=10pt,
            innerleftmargin=15pt,
            innerrightmargin=10pt
        ]
        }{%
    \end{mdframed}
}

% 自定义命令
% 高亮文本命令
\newcommand{\highlight}[1]{\colorbox{yellow!30}{#1}}

% 强调文本命令
\newcommand{\emphtext}[1]{\textbf{\color{primarycolor}#1}}

% 代码文本命令
\newcommand{\code}[1]{\texttt{\color{blue!80!black}#1}}

% 图片占位符命令（改进版）
\newcommand{\placeholderimage}[3][0.8\textwidth]{%
    \fcolorbox{black}{primarycolor!30}{%
        \begin{minipage}{#1}
            \centering\vspace{2cm}
            {\Large \textbf{#2}}\\[0.5cm]
            {\normalsize #3}
            \vspace{2cm}
        \end{minipage}%
    }%
}

% 智能图片插入命令
\newcommand{\smartimage}[4][0.8\textwidth]{%
    \IfFileExists{#2}{%
        \includegraphics[width=#1]{#2}%
    }{%
        \placeholderimage[#1]{#3}{#4}%
    }%
}

% 包结束
\endinput
